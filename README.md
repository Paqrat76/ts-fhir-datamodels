# TypeScript FHIR Data Models

This mono-repository includes a code generator for generating TypeScript FHIR data models from FHIR artifacts.
These generated data models are intended to be used by FHIR developers in their Node.js FHIR applications.

## Background

The [HAPI FHIR](https://hapifhir.io/hapi-fhir/docs/model/working_with_resources.html) ecosystem (implemented in Java)
includes data model classes representing FHIR resources and data types.
These data model classes include a number of getters and setters for the basic properties of that data model along with
many convenience methods.
These HAPI FHIR data models provided the inspiration for the design of the data models generated by this project.

A proof-of-concept (POC) project was undertaken to arrive at a design for TypeScript that could easily be applied to
generated data models.
This POC project resulted in contents for a core library that contains the base data models, implementations of the FHIR
primitive data types, and various utilities required by the data models.
Additionally, a set of implementation patterns were identified to facilitate code generation of data models for
resources and complex data types.

## Project Overview

This project is a mono-repository containing two types of NPM workspaces.
The `app` workspaces contain the code generator project and a project used to perform functional testing of a specific
set of generated data models.
The `packages` workspaces contain a project for a FHIR Core library used by all generated data model projects.
It also contains projects for each of the FHIR release-specific (FHIR R4 and later versions) generated data models.

### `app` Workspaces

#### Generator Project

The `generator` project contains the code generator for generating TypeScript FHIR data models.
This generator is not published or used independently.
It is intended to be executed from NPM scripts in the root `package.json` to generate TypeScript classes representing
FHIR data models for FHIR resources, complex data types, and selected code systems.
These generated TypeScript classes along with the `@paq-ts-fhir/fhir-core` library will be published as public NPM
libraries for each supported FHIR release (i.e., R4, R4B, R5; R6 when released).

#### Functional Test Project

The `generator-datamodel-ftest` project provides the capability to functionally test a well-defined set of generated
data models.
It is intended to simulate the production projects for generated FHIR data models.

Code patterns were identified and applied to the Handlebars templates used in the `generator` project.
Testing these code patterns is necessary to ensure generated code works as expected.
To test all of these code patterns, two custom FHIR `StructureDefinition`s were created to define custom FHIR
resources that contain all the possible patterns.
These two custom FHIR `StructureDefinition`s are consumed by the `generator` to generate their associated
data models (`TestModel` and `SimplePersonModel`).
These custom-generated data models are only used to perform a comprehensive set of functional tests to verify the
patterns used to create the data models result is correct code.

These custom resource data models make use of standard FHIR data types and reference standard FHIR resources.
The primitive FHIR data types are defined in `@paq-ts-fhir/fhir-core`.
The related complex FHIR data types are generated along with the related FHIR resources.
A separate FHIR cache (`.fhir`) was created in `test/ftest-cache/.fhir` to contain the two custom FHIR
resources along with all dependent FHIR resources and complex types.
Additionally, ValueSets and CodeSystems required to generate the pseudo-enum classes for those used by
the `code` primitive data type having a "required" ValueSet binding are included in this FHIR cache.

### `packages` Workspaces

#### FHIR Core Library

The `@paq-ts-fhir/fhir-core` package is a TypeScript library providing common base data models, primitive FHIR data
types, custom errors, and various utilities required by the FHIR release-specific generated data model packages.
This package is the sole dependency of the FHIR release-specific generated data model packages.
This package's only dependencies are the [Luxon](https://moment.github.io/luxon/#/?id=luxon-3x) and
[Zod](https://zod.dev/) libraries.

> [!IMPORTANT]
> The FHIR Core library is not designed or intended for general use in any other context.

#### FHIR Data Model Libraries

Separate projects under the `packages` directory contain the FHIR release-specific generated data models
(e.g., `@paq-ts-fhir/r4-datamodels`).
The projects contain the generated data models for all FHIR release-specific resources and complex types along with the
"pseudo-enum" classes for a related set of FHIR `CodeSystem`s.
These packages are published to NPM as public libraries.

## Development Plan

This project will be constructed in the following phases:

1. (**Completed**) Creation and initialization of the project and GitHub repository as a mono-repository
   - Initial creation of the `fhir-core` package by migrating it from GitHub [typescript-hapi-models-poc](https://github.com/Paqrat76/typescript-hapi-models-poc/tree/main/src/fhir-core)
2. (**Completed**) Creation of the data model generator
   - Create generator module
   - Create stub package for `r4-datamodels`
   - Complete generator module that can generate all code (CodeSystem pseudo-enum classes, complex type data models,
     resource data models) for FHIR R4
     - all generated code passes linting without errors or warnings
     - Typedoc does not report any errors or warnings for generated content
3. (**Completed**) Add comprehensive testing for generator
   - Unit tests for generator components with coverage exceeding 90%
   - Functional tests for generated content. This will be achieved using custom FHIR artifacts (StructureDefinitions and
     CodeSystems) used to generate content that covers all possible template combinations (refer to `typescript-hapi-models-poc`
     [src/test-models](https://github.com/Paqrat76/typescript-hapi-models-poc/tree/main/src/test-models) and
     [test/test-models](https://github.com/Paqrat76/typescript-hapi-models-poc/tree/main/test/test-models)).
4. (**Completed**) Cleanup the `fhir-core` package. The goal is to trim down the project to only include the primitive data type
   implementations, base models, dependent complex type models, utilities, errors, etc. Ensure unit test coverage
   exceeds 90%.
5. (**Completed**) Fill out project documentation for all aspects of this mono-repository
6. (**Completed**) Finalize component documentation (using [Typedoc](https://typedoc.org/)) for each package
7. (**Work-in-Progress**) Prepare the project for publication to NPM for fhir-core and r4-datamodels
8. Add the `r4b-datamodels` and `r5-datamodels` packages.
   Add a document in dev-docs that describes in detail the process of adding new data model packages.
   The `r6-datamodels`package will be added when FHIR R6 is released.
9. In each of the data model packages, implement the publication process to the NPM repository to make these libraries
   available for use by FHIR developers.
   Implement the publication of the data model documentation for consumers of these packages.
